# Quality Control op genotype-data

Het is zover! Jullie kunnen aan de slag.
De data is binnen, nu gaat het echte werk beginnen. In dit document vind je alle benodigdheden voor de kwaliteitscontrole (Quality Control, ofwel QC) van de data. We gaan dus individuen (ook wel samples genoemd) en SNPs verwijderen die van lage kwaliteit zijn en daardoor niet in onze studie thuishoren.

## Literatuur
Als het goed is, hebben jullie je al wat ingelezen in de procedures rondom QC. Mocht je toch nog wat informatie na willen kijken, kun je dat vinden in het mapje [Literatuur](https://github.com/mvvugt/U-Talent_GWAS/Literatuur) vinden. Voor deze stappen heb je vooral [GWAS3.pdf](https://github.com/mvvugt/U-Talent_GWAS/Literatuur/GWAS3.pdf) nodig.

Natuurlijk ben ik ook beschikbaar voor vragen.

## Introductie
Het is het handigst als je alle bestanden in een aparte map bewaart, waar je ook plink gedownload hebt. Aan het begin van deze stap heb je daar dus plink staan en de 3 data-bestanden die je gekregen hebt. Laten we eerst even naar deze bestanden gaan kijken.

Je ziet dat de bestanden aparte extensies hebben. Dit zijn zogeheten plink-bestanden. Op de website van [plink](http://zzz.bwh.harvard.edu/plink/index.shtml) kun je veel nuttige informatie vinden. Op [deze](http://zzz.bwh.harvard.edu/plink/data.shtml#bed) pagina vind je meer informatie over deze bestanden, maar we zullen er eerst even samen naar kijken.

### Het fam-bestand
Het eerste bestand dat we bekijken is het fam-bestand. Dit is waar alle informatie over onze individuen (cases/controls) opgeslagen is. Hier zie je een voorbeeld van de bovenste regels uit een fam-bestand (deze is niet per se gelijk aan wat jij ziet als je de eerste regels van het fam-bestand bekijkt).
```bash
# De regel hieronder is het commando dat in de terminal (command line gebruikt wordt om de eerste 10 regels van een bestand te bekijken)
head example.fam
# ID_1    1    0    0    1    1
# ID_2    2    0    0    2    1
# ID_3    3    0    0    2    1
# ID_4    4    0    0    1    1
# ID_5    5    0    0    1    1
# ID_6    6    0    0    2    2
# ID_7    7    0    0    1    2
# ID_8    8    0    0    2    2
# ID_9    9    0    0    1    2
# ID_10    10    0    0    1    2
```

Er is geen header, maar dit zijn de officiele kolomnamen en hun uitleg:

1. Family ID
2. Individual ID
3. Paternal ID
4. Maternal ID
5. Sex
  * 1 = Male
  * 2 = Female
  * Any other value = missing
6. Phenotype
  * -9 / 0 = missing
  * 1 = unaffected (control)
  * 2 = affected (case)

Van de eerste vier kolommen is in ons geval alleen de eerste van belang.

### Het bim-bestand
Het volgende is het bim-bestand, waar de informatie over de SNPs in opgeslagen is. Eerst weer een voorbeeld:
```bash
head example.bim
# 1	GSA-rs9283150	0	565508	G	A
# 1	GSA-rs9326622	0	567092	T	C
# 1	GSA-1:726912	0	726912	G	A
# 1	GSA-rs116587930	0	727841	A	G
# 1	rs3131972	0	752721	T	C
# 1	rs12567639	0	756268	G	A
# 1	GSA-rs114525117	0	759036	A	G
# 1	rs12127425	0	794332	A	G
# 1	GSA-rs79373928	0	801536	G	T
# 1	rs28444699	0	830181	G	A
```

De kolommen zijn de volgende:
1. Chromosome (1-22, X, Y, or 0 if unplaced)
2. rs# or SNP identifier
3. Genetic distance (morgans)
4. Base-pair position (bp-units)
5. Alternative allele
6. Reference allele

In dit bestand is vooral kolom 4 minder van belang voor ons project (en daarom waarschijnlijk ook altijd 0).

### Het bed-bestand
Dit bestand bevat alle genotypen, maar is een binair bestand. DEZE MOET JE DUS NOOIT OPENEN. Zodra je hem opent, wijzig je de inhoud van het bestand en kloppen de gegevens niet meer. Dit bestand is echter gemaakt uit een ped-bestand, waar je hieronder een klein voorbeeldje van ziet, maar dit bestand hebben jullie niet.
```bash
head example.ped
# FAM001  1  0 0  1  2  A A  G G  A C
# FAM001  2  0 0  1  2  A A  A G  0 0
```
Kolom 1-6 zijn gelijk aan het fam-bestand, vanaf kolom 7 begint de genotype informatie. Kolom 7 en 8 zijn de twee allelen die het individu heeft voor de eerste SNP uit het bed-bestand. Kolom 9 en 10 voor de tweede SNP etc. Als er een 0 staat, betekent dit een missende waarde en is het genotyperen daar dus mislukt.

Het bim-bestand neemt veel minder ruimte in en werkt veel sneller, daarom werken we met dit bestand. De informatie die erin staat is echter gelijk aan het ped bestand vanaf de 7e kolom. Doordat er dus geen sample- en SNP-informatie in dit bestand staat, is het van het grootste belang dat je de volgorde van de samplese en SNPs nooit wijzigt in het fam- en bed-bestand.

### Basis van plink
Zoals gezegd doen we veel van de QC met plink, dat vanuit je terminal ofwel command line werkt. Om het programma aan te zetten typ je, terwijl je in de map van plink bent: `./plink`. Elke keer als je iets met het programma wilt doen, begin je daarmee. Als je de bestandsnamen niet gewijzigd hebt, heten ze allemaal hetzelfde, maar met een andere extensie. Dit is, omdat plink alleen meer de naam zonder extensie nodig heeft om ze alle drie tegelijk te lezen. Als je data-bestanden dus `example.fam`, `example.bed` en `example.bim` heten, open je ze met het volgende: `./plink --bfile example`. Wij voegen ook altijd de optie `--noweb` toe, zodat plink sneller werkt. De volgende optie, die je bijna altijd nodig hebt, is de optie `--out`, waarmee je bepaalt onder welke naam plink bestanden opslaat. Het handigst is, om die bij elk commando een duidelijk herkenbare naam te geven, zodat je later ook nog weet wat er in het bestand staat.


## Aan de slag
### Verschil missende waardes cases/controls
We gaan beginnen met de QC. Soms gaat het genotyperen niet goed, waardoor dus missende waardes ontstaan. Dit kan door allerlei technische problemen komen, maar een oorzaak kan ook zijn, dat een allel maar bij heel weinig mensen voorkomt. We willen natuurlijk wel dat onze cases en controls vergelijkbaar blijven. Als een van de twee groepen meer missende waarden heeft voor een bepaalde SNP, dan kunnen we die SNP niet meenemen in de analyse. Onze eerste stap is dus om dat verschil te bekijken.
Kijk op de [website](http://zzz.bwh.harvard.edu/plink/summary.shtml#missing) van plink (scroll door naar het kopje __Test of missingness by case/control status__) hoe je dit uitvoert en zie de volgende stappen:

1. Open je terminal
2. Ga naar de map waar je bestanden zitten
  * commando: `cd pad/naar/je/map`
  * voorbeeld als mijn map `plink_data` heet en op mijn desktop staat: `cd Desktop/plink_data`
3. Vervang in het volgende commando de namen en plak hem in je terminal: `./plink --noweb --bfile example --geno 0.05 --mind 0.05 --make-bed --out example_filter`
  * `--bfile example` leest de bestanden `example.fam`, `example.bed` en `example.bim`
  * `--geno 0.05` verwijdert alle SNPs waar meer dan 5% van de individuen missende waarden heeft
  * `--mind 0.05` verwijdert alle individuen die meer dan 5% missende SNPs heeft
  * `--make-bed` zorgt ervoor dat plink weer binaire bestanden (fam/bed/bim) maakt
  * `--out example_filter` zorgt ervoor dat alle bestanden die in deze stap gemaakt worden als voorvoegsel `example_filter` hebben. Bij elk commando maakt plink een bestand (`example_filter.log` in dit geval) waarin wat uitleg staat over deze stap.
4. Vervang in het volgende commando de namen en plak in je terminal: `./plink --noweb --bfile example_filter --test-missing --out example_test_missing`

Kijk op de website van plink in welk bestand je moet zoeken voor de resultaten en wat deze kolommen betekenen. Voer daarna de volgende stappen uit:
5. Open het bestand met de resultaten (in excel bijvoorbeeld)
6. Filter het bestand voor een `p-waarde < 1e-5` (0.00001)

De SNPs die nu overblijven zien wij als SNPs die verschillen tussen onze cases en controls en die moeten dus weg. We gaan nu een bestand aanmaken, waarin we alle SNPs gaan zetten die we uit onze studie weghalen.
7. Kopieer de kolom met de SNP-namen (inclusief header) naar een nieuw excel-sheet
8. Maak een tweede kolom met als header `Reden` en typ daar (voor elke nu toegevoegde SNP): `verschil_missend`
9. Sla op als txt-bestand in je map. In het vervolg wordt dit bestand `example_snp_exclusie.txt` genoemd

### Missende waardes individuen
